const Net = require('net');
const { buffer } = require('stream/consumers');

const PORT  = 8888;

const server = Net.createServer();
const clients = new Set();

const packets = {
    1: 'ddccbbaa0100000000000000ea07011c15020e7c0100000000',
    2: 'ddccbbaa020000006f000000ea07011c15020cff00ac00000001000000000000010000000000000000000300000000180d8f0000000000f9029500000000a8610000000000000000000000000000000000000000000000000000000000000080af5754010000000081485d01000000a8610000000000000000000000000000000000000000000000000000000000000000d3fb2f0100000000b4f13501000000a8610000000000000000000000000000000000000000000000000000000000000001000000',
    4: 'ddccbbaa0400000000000000ea07011c15020e7c012e000000413238303132360031333037333900e59d366e2ef50ec057c8786e2380d449404e00000000000000000700809e42',
    6: 'ddccbbaa0600000000000000ea07011c150d05c802240100009200000000000000000000000100000040ab41910000000001000000444a49204d696e69342070726f28524944290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000003135383146365a3900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
    11: 'ddccbbaa1100000000000000ea07020a14161ae700ae0d0000020300000000ce06000003000000000000008dd5ced365d2c2d46fd3fbd36fd346d136d59ad3d9d2fdd0add3f1d30cd5a5d2dfd286d2d6d419d41ad64ad5e6d388d3c9d3f5d1d3d2bbd409d352d464d546d4a9d4ced2d0d19ad5ccd389d46ad054d574d2d0d1f9d410d5f9d132d688d1e4d2e6d153d020d2cfd066d1aad4afd340cff5d4fbd34ad416d4dfd60cd497d4d4d2acd2afd312d563d248d1c4d249d149d436d4dcd3dcd4cad56bcf14d405d37ed582d225d4f2d3bdcf1fd118d1b4d468d4d2d408d4efd2e9d51ad36ad2bfd07fd269d316d429d3b5d38bd059d36dd3bad293d252d3ecd4ced2f3d10ad06dd4d1d470d380d4f2d32bd228d5acd4c3d43cd663d6aed16bd240d1aad4bed58ad34cd3add4add246d4eed517d48ad4a9d244d383d501d5d1d2d6d3c3d31ed3b0d29ad548d306d5c7d23ed55ad393d381d5f4d3a6d542d5a2d207d570d498d447d3d0d317d29ad1ebd1cfd5e8d0c9d3d7d49ed17ed4a3d164d4ecd432ce2ad61fd20ad48dd328d5dbd318d468d487d364d4afcf88d237d3e5d569d571cf8cd6ffd204d456d43ed581d45fd256d3b1d0b3d343d055d67ed207d3a7d159d22cd569d55bd066d486d5b3d586d533d06ed672d301d4a5d2d7d378d2bed4b2d42bd53fd25ed5f0d427d478d354d3f9d223d4b5d1b5d28bd26fd06ad279d46cd306d4c1d2b4d139d560d4cbd4c0d444d651d4c2d47ed1efd4c1d569d402d50fd056d3dcd4b8d387cf7fd119d2e9d2aed34ed351d1e6d4fbd3a5d4e4d331d477d38bd5b9d5f0d4ded69ad51bd08ed5ecd559d379d3fad1c0d347d3ccd4b1d4f0d3e9d353d2f4d49fd2f1d14cd469d1f7d511d3dcd4efd46ad4d9d49dd5c6d4add4b0d18bd5ccd463d508d544d4a2d530d32cd3aed29fd095d413d6f7d2ead5acd512d5d7d2c2d1b0d24ed523d1e2d352d58ad4a4d386d320d42ed19bd225d4e0d2e0d330d12cd5f2d339d528d480d6d2d333d419d2a5d1cdcd34d20bd482d40fd659d18bd561d290d340d2a1d4bdd4b3d202d30dd09cd4a9d0b0d5b4d0a6d2a9d2bfd515d5ecd101d469d56bd053d593d2a8d529d56bd523d3cdd31bd4e7d28ed2abd58ad2d4d46ed535d442d55dd385d48ed422d42ad3acd3d6d172d42dd4bbd2b0cfbad367d388d117d06bd4c0d2bfd0f9d1d5d3c5d0e5d367d2e4d20fd5ded5f2d438d1acd148d38dd3f4d0c3d24dd301d1f5d48cd2b3d477d1c9d470d3c5d20ad3f4d410d134cd74d469d43dd2a0d3dad565d220d60dd671cffad0c1d12fd2afd26bd159d241d489d294d1e3d4f0d2c2d004d20bd5b2d185d3b9d3d7d2fed33dd2d6d4f4d51fd3a8d159d4d9d570d14cd3b0d6a2d4e4d3fad138d5b6d4ddd48dd43ed39dd225d3abd4d4d248d37fd3bed511d468d37ed203d503d3a0d39ed38ed291d581d42ed4fad24ecf69d457d4f0d3d3d425d06ed3c5d281d172d290d21fd6dfcd5dd483d133d49bd207d48ed321d54bd50cd32ed48cd445d317d3fed32ad548d35ed281d4e7d26ad4bfd386d2f3cf34d5e5d24dd204d4a2d267d09ad464d1a9d3f0d3c5d2e9d450d0e0d387d421d553d185d227d3b3d3a0d5c8d4b2d357d2e5d5d2d5d5d299d4aed08ed466d370d45bd3b2d2b8d4d8d13dd4ecd465d4e7d4c5d2fdd2fdd044d308d4b1d37ad156d1fbcf36d5bbd47fd35dd008d65ad0abd49cd39cd439d57ed070d4fad3a7d30fd45fd339d208d219d491d204d29fd053d341d4facfdcd08dd401d304d47cd36fd4b7d0ebcfe8d393d2a0d3e8ce61d4f1d1f8d331d3e6d3f8d21fd26ed278d295d4abd5ced5e5d3f0d456d592d376d312d4aad663cd6fd5d1d192d6aed3f2d4b8d3c2d3ffd1d9d3fdd297d4a5ce85d460d03ed541cf80cfd1d4f0d1b6d434d297d4b5d3e4d4fed2eed2ecd5a7d3a3d0b9d254d255d5a6d47ad5f9d1c2cff0d236d023d416d10bd22bcfccd161d5b9d07bd395d556d09cd44ed482d379d431d159d1b6d2f3d467d583d391d35acf6dd4bbd3cbd351d1d0d0cad369d4f0d1f6d270cf47cfe0d250cf2dd462d1d8d20dd14fd5d4cebccceed1cad2f6d316d357d38fd255d27dd073d228d4ecd3f2d3fdd3a6d417d529d58ed46fd126d268d41ed692d32ed2b1cc60d102d6a2d29dd409d6c7d50cd3fccf64d02ed379d27bd5bdd1dcd494d444d04fd045d3f5d177d1cbd471d375d3d8d126d38ad3fccf5cd1bbd214d05dd5b9d44fd375d4e2d1ced305d235d4d5d450d4f6d224d39cd451d402d2fbd381d438d156d462d4f5d089d359d26dd3ebcefbd320d36ed31ed462d392d141d36bd229d1ced525d37bd2ffd36fd36bcfaad3f8d276d5b7d4f2d503d5ddd233d452d478d609d5e9cf8dd26bd5f7cf94d34ed36ed0e1d3e0d470d4dcd3a4d407d1e7d0add43ed4f1d457d348d2ccd20bd5d0d372cffccd93d273d282d37bd25ace41d1c2d335d155d5a4d139d5e6d470d02fd371d4b2d319d3a2d360d133d3a8d122d23ed24dd2a4d4d1d241d015d2bdd2d7d323d2c5d530d28cd333d31bd4a5d3b3d1f4d1a4d26ed3f3d247d21fd349d355d569d184d208d27bd082d0dfd25bd443d4d3d226d31bd3acd439d412d3ead3aed250d1fcd2bfd1c9d141d251d3aed485d232d47ad2fad4d4d379d3d3d103d41bd3ced2aad169d5d1d3e4d422d35fd490d413d38dd1f2cf5cd2ded09bd43fd5f8d403d13bcd3ed5ddd03cd6aed2fad276d3f9d203d41fd3dcd23ed3fcd299d16bd3b4d3ecd3d9d420d3a7d217d3f9d3c9d1b6d5ddd4aad380d10ad1ccd1a5d4c6d0fcd3b7cf5fd301d127ce17d3a8d116d517d42bd53bd49ecf46d52fd369d3b8ce1fd445d47bd20dd469d38bcf71d1d7d0a3d1b8d3bcd332d599d3fad41fd4bad582d48bd227d4cdd0a6d0c2d226d4a9d429d17fd1e2d0a1d46ad456ce11d5d4d223d48ed3ded0ebd0efd272d4b9d56ad3a2d2c3d19fd4e3d364d2f3d040d19fd3a5d3b2d344d483d125d2e5d3d7d582d5aed35ad42bcf7dcfaad39bcf9ad418d3add37fd00cd15bd29cd3c3d295d1f3d097d465d566d2c5d01ed483d551d293d105d4ddd269d11dd6f3d288d1dad338d45bd3a8d285d3afd318d30ad17ed4fcd369cc34d439d46bd2aed262d68dd170d620d42cd1a7d244d346d3c5d47ad40ed55ed4fad2a2d59fd17dd2cfd17fd10fd260d208d4b5d566d348d300d490d302d009d305d2e5d35ed48bd393d4d8d347d03ed1b9d30fd6dbd57cd3f0d1cdd0cfd41bd1cbd42fd423d134d45ad43cd4dcd356d554d319d472d3ffd34bd1b1d3d0d4ebd27fd1bfd469d0bbd2abd5f0d388d4cbd340d150d456d50fd20ed1c4d227d4d3d228d339d2dbd4e7d4d5d1aad3f4d13cd260d281d353d2c9d4dfd180d653d131d174d3a1d3f2d297d49fd488d4f3d4dbd503d530d2b8d2a2d4fcd306d1c4d19cd0d5d48ed343d24ad235d3dad121d394d0bbd23fd30ed23bd4b2d3b2d2d0d42ad4ccd2a9d21cd5b0d37ed45bd498d4cbd326d42bd19ed4e7d139d5f4ce03d4fdd5f3d33dd668d48ad3bfd3aad419d4a4d5c5d4b7d555d504d459d5cad5e4d13ad495d402d39ed47fd669d355d5ecd5e6d458d718d855d7d1d784d726d613d811d8ecd8bdd5e7d49fd7c3d730d64ed151d4c3d501d560d595d6d3d3f9d650d79ed484d7c2d4a6d606d893d583d94fd7f7d71fd57ed771d819d834d50ed6a4d889d4e8d4a5d4ccd7f7d7abd80fd8d9d732d3aad79fd767d563d70ed7dad692d59ad8dfd921d756d651d517d7dcd71cd85fd726d89ed7abd9e4d862d5efd60ed87cd6b6d4f1d4e7d6a0d413da21d622d545d7abd607d616da5ed68ed8c8d7edd7e3d4b8d869dbc2d55dd979d7bcd753d9c6d641d3d2d3fbd536d68cd785d671d275d8ead785d89dd908d94ed6b9d860d887d8fad75adbacd822d699d908d805d924d6c5d83cd824d967d9a3d8f2d511d7a4d86cda7dd7cbd555daa8d906daced840d803d5f0d797d7c5d898d676d9a7d9bcd7c7d980d750d73dd8d4d5e8d417d8c8d511d8b9d9e2d89bdad1d8ecd430da72d825d77fd97bd48fd5c9d86fd9f0d8ddd8aed7fad715d77cd816d9b5d7e9d8ecd93dd8f1d6a5d852d73ed7bad89ed74bd75fd7b6d4fbd935d885d8abd3bfd8dad1a3d8b5d691d7f1d76ed721d768d493d7d0d631d899d7ebd85bd5d8d59cd75ad820d75bd876da2dd620d147d81cd81fd8d1d43fd4fed62fd90fd64cd46ad72dd5b6d89dd7ced508d7b3d7dad7e1d8a2d87cd6d6d5a5d3bed3bbd94fd8a2d35cd64dd65cd71dd9cad532d476d71dd686d78ed62fd645d77dd56fd7edd829d203d60ed717d8ead628d5b3d2f3d59fd4c2d786d8f0d5ead3f6d651d4d2d4ffd76ad202d356d7a8d285d384d2d5d419d5ddd2ebd359d565d4c1d40dd1ebd372d5ddd37ed18bd3b3d4cfd248d14ad400d4f9d3c5d350d14ed23cd6f9d51ad224d2edd576d2d9d2add3c7d2dcd348d276d1d9d00fd1cdd0dad30cd2cdd043d43bd4abd462d1b4d4ced3abd211d4fcd30ed2dcd1cad26dd19ad32cd34dd3dad261ceb8d4fbd0e1d3f8d35ed21fd32dd4ded4ddd5e2d1ecd6d6d6d2d28ad5d6d6a7d490d5b7d4e9d424d747d265d39fd691d579d48ed11ed7f6d293d4ecd55cd26fd5e8d5a8d21fd3e7d474d52cd54cd739d7b9d3f6d43fd273d1add3ebd17dcf21d37cd48cd1abd41bd3f7d47bd3f1d0c3d23acfeecee9d37bd281d4ebd009cf9ad3b9d6d9d25ed1a7d259d4bfd582d382d2dcd249d433d10ed279d4cdd3dbd1e0d425d578d250d162d64fd459d4b1d1a6d44bd18cd160d001d4bcd436d493d4a7d3e4d4efd109d5b6d3f2d278d2c3d4a8d403d4d3d508d672cfcfcf2bd2fad30ad137d585d160d1fdd32fd142d5cad168d4eed167d31fd390d250d3d7d44ad597cf5fcdedcedbd30dd4c1d1f3ce12d2fad6edd592d567d465d3c7d476d398d4bed0eed536d2fbd28cd146d319cf70d2',
    90: 'ddccbbaa9000000000000000eaff07011c15020c000400000000000000',
    92: 'ddccbbaa9200000000000000ea07011c150d05c802cc000000010000003135383146365a390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000444a49204d696e69342070726f28524944290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040ab41910000000000000000000000000080684004000000000000000100000076543541d4d14940e50e9bc8cc450fc0bde3141dc9d149407b319413ed4a0fc00000824200000000',
    101: 'ddccbbaa1010000000000000ea07011c15020e7c0100000000',

    102: 'ddccbbaa1300000000000000ea07011c15020e7c0100000000',
}

server.on('connection', function(sock){
    console.log("CONNECTED: " + sock.remoteAddress + ":" + sock.remotePort);
    clients.add(sock);
    
    sock.on('data', function(data){
        console.log("DATA " + sock.remoteAddress + ":" + data);
        
        // const packet = Buffer.from(packets[1], 'hex');
        // sock.write(packet);
    });

    sock.on('end', function(){
        console.log('CONNECTION CLOSED: ' + sock.remoteAddress + ':' + sock.remotePort);
        clients.delete(sock)
    });

    sock.on('error', function(err){
        console.log(`Error ${sock.remoteAddress}: ${err}`);
        clients.delete(sock);
    });
});

server.listen(PORT, () => {
    console.log('TCP server is running on port' + PORT);
});


process.stdin.setEncoding('utf8');
process.stdin.on('data', input =>{
    const cmd = input.trim();

    const hex = packets[cmd];
    if(!hex){
        console.log(`Unknown command: ${cmd}`);
        return;
    }

    const packet = Buffer.from(hex, 'hex');
    console.log(`Sending command ${cmd}`);

    for(const sock of clients){
        sock.write(packet);
    }
});
